# This file is generated by Chef. All changes will be discarded on next chef run.
# Please, be careful.

upstream foreman-web {
  server 127.0.0.1:<%= @foreman_app_port %> fail_timeout=0;
}

server {
 listen 0.0.0.0:80;

 server_name <%= node['fqdn'] %>;

 root <%= @foreman_app_path %>/public/;

 charset utf-8;

 access_log <%= node['nginx']['directories']['log_dir'] %>/foreman-web.access.log detailed;
 error_log <%= node['nginx']['directories']['log_dir'] %>/foreman-web.error.log;

 client_max_body_size 32M;

 location /assets {
   expires max;
 }

 location / {
   try_files $uri /system/maintenance.html @foreman-web;
 }

 location @foreman-web {
   proxy_pass http://foreman-web;
   proxy_redirect off;

   proxy_set_header Host $host;
   proxy_set_header X-Real-IP $remote_addr;
   proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

   proxy_connect_timeout 10;
   proxy_send_timeout 300;
   proxy_read_timeout 300;

   proxy_buffer_size 16k;
   proxy_buffers 32 16k;
 }
}
